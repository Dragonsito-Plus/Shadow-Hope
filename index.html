<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Shadow Hope 1 ‚Äî Web Oficial</title>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script type="text/javascript">
       (function(){
          emailjs.init("Kyr2sQBZLHihuoJud");
       })();
    </script>

    <style>
        /* ESTILOS BASE */
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f1a; margin: 0; color: #eee; overflow-x: hidden; }
        * { box-sizing: border-box; }
        
        /* BARRA DE NAVEGACI√ìN */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: #1a1a2e; border-bottom: 2px solid #3b3b6a; position: fixed; width: 100%; top: 0; z-index: 1000; }
        .nav-left { display: flex; gap: 10px; align-items: center; }
        .btn-nav { background: transparent; border: 1px solid #0a6bff; color: #0a6bff; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-nav:hover { background: #0a6bff; color: #fff; }

        /* CONTENIDO PRINCIPAL */
        .container { max-width: 1000px; margin: 100px auto 40px; padding: 0 20px; }
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: #1f1f2e; padding: 30px; border-radius: 8px; border: 1px solid #3b3b6a; margin-bottom: 20px; }
        .product { display: flex; gap: 30px; align-items: center; flex-wrap: wrap; }
        .thumb { width: 200px; height: 200px; background: linear-gradient(135deg, #111, #3b3b6a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; text-align: center; }
        
        /* BOTONES DE DESCARGA */
        .btn-os { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; }
        .btn-android { background: #3ddc84; color: #000; }
        .btn-windows { background: #00a4ef; color: #fff; }

        /* MEN√ö DESPLEGABLE */
        .dropdown { display: none; position: absolute; right: 0; top: 45px; background: #1a1a2e; border: 1px solid #3b3b6a; border-radius: 8px; min-width: 180px; z-index: 1001; box-shadow: 0 8px 16px rgba(0,0,0,0.5); }
        .dropdown a { display: block; padding: 15px; color: #eee; text-decoration: none; border-bottom: 1px solid #2a2a40; cursor: pointer; transition: 0.2s; }
        .dropdown a:hover { background: #3b3b6a; }

        /* MODALES */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-overlay.active { display: flex; }
        .modal-content { background: #1f1f2e; padding: 30px; border-radius: 8px; width: 90%; max-width: 400px; text-align: center; position: relative; border: 1px solid #3b3b6a; }
        
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #111; border: 1px solid #3b3b6a; color: #fff; border-radius: 4px; outline: none; }
        .modal-btn { width: 100%; padding: 12px; background: #0a6bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-danger { background: #ff4444; margin-top: 20px; }
        .loader { display: none; border: 3px solid #f3f3f3; border-top: 3px solid #0a6bff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="g_id_onload" 
         data-client_id="593613328099-79dqui4ns96lbjgmumg9goclnf4ug71g.apps.googleusercontent.com" 
         data-callback="handleCredentialResponse">
    </div>

    <nav>
        <div class="nav-left" id="user-controls">
            <button class="btn-nav" onclick="openModal('login-modal')">Iniciar sesi√≥n</button>
        </div>
        <div class="menu-container" style="position: relative;">
            <div style="cursor:pointer; font-size:28px; color: #fff;" onclick="toggleMenu()">‚ò∞</div>
            <div class="dropdown" id="dropdown-menu">
                <a onclick="showSection('inicio')">üè† Inicio</a>
                <a onclick="showSection('tienda')">üõí Tienda</a>
                <a onclick="showSection('comunidad')">üí¨ Comunidad</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="inicio" class="section active">
            <h1>Shadow Hope 1</h1>
            <div class="card">
                <h3>Sobrevive a la oscuridad</h3>
                <p>Bienvenido al sitio oficial. Descarga el juego, reporta fallos y √∫nete a la experiencia.</p>
            </div>
        </div>

        <div id="tienda" class="section">
            <h1>Tienda</h1>
            <div class="card product">
                <div class="thumb">SHADOW<br>HOPE</div>
                <div class="info">
                    <h2>Descarga Directa</h2>
                    <p>Selecciona tu plataforma:</p>
                    <button class="btn-os btn-android" onclick="descargar('android')">Descargar APK (Android)</button>
                    <button class="btn-os btn-windows" onclick="descargar('windows')">Descargar ZIP (Windows)</button>
                </div>
            </div>
        </div>

        <div id="comunidad" class="section">
            <h1>Comunidad</h1>
            <div class="card">
                <h3>Reportar Bug / Comentario</h3>
                <textarea id="bug-text" placeholder="Escribe aqu√≠ tu mensaje..."></textarea>
                <button class="modal-btn" onclick="enviarComentario()">Enviar</button>
            </div>
        </div>
    </div>

    <div id="username-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Configura tu Perfil</h2>
            <input type="text" id="new-username" placeholder="Elige un Username">
            <input type="password" id="new-password" placeholder="Crea una contrase√±a">
            <button class="modal-btn" onclick="saveNewProfile()">Guardar y Entrar</button>
        </div>
    </div>

    <div id="login-modal" class="modal-overlay">
        <div class="modal-content">
            <span onclick="closeModal('login-modal')" style="position:absolute; right:15px; top:10px; cursor:pointer; font-size:20px;">&times;</span>
            <h2>Entrar</h2>
            <div id="google-btn-login" style="display:flex; justify-content:center;"></div>
            <hr style="border:0; border-top:1px solid #3b3b6a; margin:20px 0;">
            <p style="font-size: 14px; color: #aaa;">O usa tu correo (te enviaremos un c√≥digo)</p>
            <input type="email" id="login-email" placeholder="Correo electr√≥nico">
            <button class="modal-btn" onclick="sendCode('login')">Enviar C√≥digo al Correo</button>
            <div id="loader-login" class="loader"></div>
            
            <div id="login-verification" style="display:none; margin-top:15px;">
                <input type="text" id="login-code" placeholder="C√≥digo recibido (4 d√≠gitos)">
                <input type="password" id="login-pass" placeholder="Tu contrase√±a">
                <button class="modal-btn" style="background:#00e676; color:#111;" onclick="verifyLogin()">Verificar y Entrar</button>
            </div>
        </div>
    </div>

    <div id="profile-modal" class="modal-overlay">
        <div class="modal-content">
            <span onclick="closeModal('profile-modal')" style="position:absolute; right:15px; top:10px; cursor:pointer; font-size:20px;">&times;</span>
            <h2>Mi Perfil</h2>
            <p id="profile-email-display" style="color:#888; font-size:12px;"></p>
            <button class="modal-btn" onclick="requestChange('username')">Cambiar Username</button>
            <button class="modal-btn" onclick="requestChange('password')">Cambiar Contrase√±a</button>
            <div id="change-area" style="display:none; margin-top:20px;">
                <div id="loader-change" class="loader"></div>
                <input type="text" id="change-code" placeholder="C√≥digo enviado">
                <input type="text" id="change-value" placeholder="Nuevo valor">
                <button class="modal-btn" onclick="applyChange()">Confirmar Cambio</button>
            </div>
            <button class="modal-btn btn-danger" onclick="logout()">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <script>
        let currentUser = JSON.parse(localStorage.getItem('user_session')) || null;
        let codeGenerated = ""; 
        let pendingChangeType = "";

        window.onload = function () {
            renderUserNav();
            // Cargar bot√≥n de Google
            google.accounts.id.renderButton(document.getElementById("google-btn-login"), { theme: "outline", size: "large" });
        }

        // --- NAVEGACI√ìN ---
        function toggleMenu() {
            const menu = document.getElementById('dropdown-menu');
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            toggleMenu();
        }

        // --- GOOGLE ---
        function handleCredentialResponse(response) {
            // Flujo simple para la web est√°tica
            let userEmail = "usuario_google@gmail.com"; 
            let existing = JSON.parse(localStorage.getItem(userEmail));
            if (!existing) {
                sessionStorage.setItem('temp_email', userEmail);
                openModal('username-modal');
                closeModal('login-modal');
            } else { loginUser(existing); }
        }

        // --- EMAILJS (CON TUS IDs REALES) ---
        function sendCode(type) {
            const email = (type === 'login') ? document.getElementById('login-email').value : currentUser.email;
            const loader = (type === 'login') ? document.getElementById('loader-login') : document.getElementById('loader-change');
            if (!email.includes("@")) return alert("Por favor, introduce un correo v√°lido.");

            loader.style.display = "block";
            // Genera el c√≥digo aleatorio de 4 n√∫meros
            codeGenerated = Math.floor(1000 + Math.random() * 9000).toString();

            // Usa tu Service ID y Template ID reales
            emailjs.send('service_oyw7kda', 'template_b4tefri', { 
                to_email: email, 
                passcode: codeGenerated 
            })
            .then(() => {
                loader.style.display = "none";
                alert("¬°C√≥digo enviado! Revisa tu bandeja de entrada o la carpeta de SPAM.");
                if(type === 'login') document.getElementById('login-verification').style.display = 'block';
                else document.getElementById('change-area').style.display = 'block';
            }, (error) => { 
                loader.style.display = "none"; 
                alert("Error al enviar el correo. Detalles: " + JSON.stringify(error)); 
            });
        }

        function verifyLogin() {
            const email = document.getElementById('login-email').value;
            const code = document.getElementById('login-code').value;
            const pass = document.getElementById('login-pass').value;

            if (code !== codeGenerated) return alert("El c√≥digo es incorrecto.");
            let user = JSON.parse(localStorage.getItem(email));
            
            // Si el usuario existe y la contrase√±a es correcta
            if (user && user.password === pass) {
                loginUser(user);
            } 
            // Si el usuario no existe, le pedimos crear su perfil
            else if (!user) {
                sessionStorage.setItem('temp_email', email);
                openModal('username-modal');
                closeModal('login-modal');
            } else {
                alert("Contrase√±a incorrecta.");
            }
        }

        // --- PERFIL Y SESI√ìN ---
        function saveNewProfile() {
            const user = {
                username: document.getElementById('new-username').value,
                password: document.getElementById('new-password').value,
                email: sessionStorage.getItem('temp_email')
            };
            if(!user.username || !user.password) return alert("Rellena todos los campos.");
            
            localStorage.setItem(user.email, JSON.stringify(user));
            loginUser(user);
            closeModal('username-modal');
        }

        function loginUser(user) {
            currentUser = user;
            localStorage.setItem('user_session', JSON.stringify(user));
            renderUserNav();
            closeModal('login-modal');
            alert("¬°Bienvenido, " + user.username + "!");
        }

        function renderUserNav() {
            const nav = document.getElementById('user-controls');
            if (currentUser) {
                nav.innerHTML = `<span style="color:#00e676; font-weight:bold; margin-right:10px;">@${currentUser.username}</span>
                                 <button class="btn-nav" onclick="openProfile()">Mi Perfil</button>`;
            } else {
                nav.innerHTML = `<button class="btn-nav" onclick="openModal('login-modal')">Iniciar sesi√≥n</button>`;
            }
        }

        function openProfile() {
            document.getElementById('profile-email-display').innerText = currentUser.email;
            openModal('profile-modal');
        }

        function requestChange(type) {
            pendingChangeType = type;
            sendCode('change');
        }

        function applyChange() {
            const code = document.getElementById('change-code').value;
            const val = document.getElementById('change-value').value;
            if (code === codeGenerated && val) {
                currentUser[pendingChangeType] = val;
                localStorage.setItem(currentUser.email, JSON.stringify(currentUser));
                localStorage.setItem('user_session', JSON.stringify(currentUser));
                alert("Datos actualizados correctamente.");
                location.reload();
            } else {
                alert("El c√≥digo es incorrecto o el campo est√° vac√≠o.");
            }
        }

        function logout() { 
            localStorage.removeItem('user_session'); 
            location.reload(); 
        }

        // --- UTILIDADES ---
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function descargar(os) { 
            alert("Preparando descarga para " + os + "..."); 
            window.location.href = (os === 'android') ? "Shadow Hope 1 Android.apk" : "Shadow Hope 1.zip"; 
        }
        function enviarComentario() { 
            const texto = document.getElementById('bug-text').value;
            if(!texto) return alert("Escribe un comentario primero.");
            alert("Mensaje enviado a la comunidad. ¬°Gracias por tu reporte!"); 
            document.getElementById('bug-text').value = ""; 
        }
    </script>
</body>
</html>